# 비동기 처리(Promise, Callback, async/await)

callback, promise, async/await은 자바스크립트에서 비동기 처리를 담당하고 있습니다. callback은 ES5 버전 이전, 프로미스는 ES6버전에 나왔고, async와 await은 ES8 버전에 나왔습니다. 

### **callback 함수란?**

다른 함수가 실행을 끝낸 뒤 실행되는 함수, 나중에 호출되는 함수를 말한다. 쉽게 말해 함수를 등록해 놓은 후 어떤 이벤트가 발생했거나 특정 시점에 도달했을 때 시스템에서 호출하는 함수이다.

하지만 콜백함수에도 치명적인 단점이 있다. 바로 **콜백 지옥과 에러 처리가 힘들다는 점**이다.

### **콜백 지옥이란?**

보통 비동기 함수는 비동기 처리 결과를 외부에 반환할 수도 없고, 상위 스코프의 변수에 할당할 수 도 없다. 그래서 처리결과에 대한 후속 처리는 비동기 함수내부에서 수행해야 한다. 비동기 함수에 비동기 처리 결과에 대한 후속 처리를 수행하는 콜백 함수를 전달하는 것이 일반적이다. 필요에 따라 비동기 처리가 성공하면 호출될 콜백 함수와 비동기 처리가 실패하면 호출될 콜백 함수를 전달할 수 있다.

이처럼 함수의 처리 순서를 보장하기 위해서는 콜백 함수가 해당하는 결과 값을 가지고 다른 콜백함수를 호출하고, 그 결과 값으로 또다른 콜백 함수를 호출하는 방식으로 함수를 중첩하게 사용되는 경우가 생겨 복잡도가 높아지는 현상이 발생하는데, 이를 콜백 지옥이라고 한다. 콜백 지옥은 한눈에 로직을 파악하기도 어렵고, 에러 해결이나 디버깅, 유지보수 등이 어렵다는 단점이 있다.

이러한 단점을 극복하기위해 ES6에서 프로미스가 도입되었다.

### **promise란?**

자바스크립트에서 비동기 처리에 사용되는 객체이다. promise 객체는 비동기 작업이 맞이할 미래의 완료 또는 실패와 그 결과값을 나타낸다. Promise는 매개변수(파라미터)로 excutor라고 하는 함수를 받고, 이 함수는 resolve와 reject 함수를 전달받는다. 

비동기 처리가 성공하면 콜백 함수의 인수로 전달받은 resolve함수를 호출하고, 실패하면 reject 함수를 호출한다. 

프로미스는 3가지 상태 정보를 갖는다.

- pending : 비동기 처리 로직이 아직 완료되지 않은 상태이다.
- fulfilled : 비동기 처리가 완료되어 프로미스가 결과 값을 반환해준 상태. resolve 함수를 호출하면 fulfilled상태로 바뀐다.
- rejected : 비동기 처리가 실패하거나 오류가 발생한 상태.reject 함수를 호출하면 rejected상태로 바뀐다.

비동기 처리결과에 대한 후속 처리는 프로미스가 제공하는 후속 처리 메서드 then, catch, finally를 사용하여 수행한다. 처리 과정에서 발생한 에러는 then 메서드의 두 번째 콜백 함수나 catch메서드로 처리할 수 있다.

**async / await란?**

비동기식 코드를 동기식으로 표현하여 간단하게 나타낼 수 있다.

프로미스를 기반으로 동작한다. async/await를 사용하면 프로미스의 then/catch/finally 후속 처리 메서드없이 마치 동기 처리처럼 프로미스가 처리 결과를 반환하도록 구현할 수 있다.

asnyc 함수는 function 앞에 위치하며, async 키워드를 사용해 정의하며 언제나 프로미스를 반환한다.async 함수가 명시적으로 프로미스를 반환하지 않더라도 async 함수는 암묵적으로 반환값을 resolve하는 프로미스를 반환한다. async 함수는 화살표 함수로도 정의가 가능하고, 함수 표현식으로도 정의가 가능하다. 

await 키워드는 반드시 async 함수 내부에서 사용해야 한다.  프로미스가 비동기 처리가 수행된 상태가 될 때까지 대기하다가 이행이 완료되면 그 결과 값을 반환하고 다음 코드를 실행한다.  await 키워드는 반드시 프로미스 앞에서 사용해야 한다. 





