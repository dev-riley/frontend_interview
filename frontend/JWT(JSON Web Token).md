# JWT(JSON Web Token)

JWT에 대해 알아보기 전 먼저 토큰에 대해서 알아보자.

## **Token**

토큰은 보통 서버가 클라이언트 인증을 확인하는 방식 중 하나이다. 토큰 기반 인증 시스템은 클라이언트가 서버에 접속을 하면 서버에서 해당 클라이언트에 인증되었다는 의미로 '토큰'을 부여한다. 이 토큰은 유일하며 토큰을 발급받은 클라이언트는 또다시 서버에 요청을 보낼 때 요청 헤더에 토큰을 심어서 보낸다. 그러면 서버에서는 클라이언트로부터 받은 토큰을 서버에서 제공한 토큰과의 일치 여부를 체크하여 인증 과정을 처리하게 된다.

토큰은 앱과 서버가 통신 및 인증할 때 많이 사용된다. 웹에는 쿠키와 세션이 있지만 앱에는 없기 때문이다.



## **JWT(JSON Web Token)**

JWT는 인증에 필요한 정보들을 암호화시킨 JSON토큰을 말한다. 그리고 JWT 기반 인증은 JWT 토큰(Access Token)을 HTTP 헤더에 실어 서버가 클라이언트를 식별하는 방식이다. 

토큰은 세션과 달리 서버가 아닌 클라이언트에 저장되기 때문에 서버의 부담을 줄일 수 있다. 

**JWT가 가지는 가장 큰 특징은 토큰 자체에 사용자의 권한 정보나 서비스를 사용하기 위한 정보가 포함된다는 것이다.** 토큰이 한 번 발급이 된 이후 사용자의 정보를 바꾸더라도 토큰을 재발급하지 않는 이상 반영되지 않는다.

JWT를 사용하면 RESTful같은 무상태(stateless)인 환경에서 사용자 데이터를 주고 받을 수 있게된다. 토큰을 이용하면 요청시 단순히 HTTP 헤더에 토큰을 첨부하는 것만으로도 데이터를 요청하고 응답을 받을 수 있다.

[ JWT 사용시 과정 ]

1. 클라이언트 사용자가 아이디, 패스워드를 통해 웹서비스 인증.
2. 서버에서 서명된(signed) JWT를 생성하여 클라이언트에 응답으로 돌려주기
3. 클라이언트가 서버에 데이터를 추가적으로 요구할 때 JWT HTTP Header에 첨부.
4. 서버에서 클라이언트로부터 온 JWT를 검

JWT는 **JSON 데이터를 Base64 URL-safe Encode를 통해 인코딩하여 직렬화한 것**이며, 토큰 내부에는 위변조 방지를 위해 개인키를 통한 **전자서명**도 들어있다. 따라서 사용자가 JWT를 서버로 전송하면 서버는 서명을 검증하는 과정을 거치게 되며 검증이 완료되면 요청한 응답을 돌려준다.



## JWT 구조

JWT는 `.`을 구분자로 나누어지는 세가지 문자열의 조합이다. `.`을 기준으로 좌측부터 Header, Payload, Signature를 의미한다.

Header 에는 JWT 에서 사용할 타입과 해시 알고리즘의 종류가 담겨있으며, Payload 는 서버에서 첨부한 사용자 권한 정보와 데이터가 담겨있다. 마지막으로 Signature 에는 Header, Payload 를 Base64 URL-safe Encode 를 한 이후 Header 에 명시된 해시함수를 적용하고, 개인키(Private Key)로 서명한 전자서명이 담겨있다.



## JWT 장점과 단점

장점

- Header와 Payload를 가지고 Signature를 생성하므로 데이터 위변조를 막을 수 있다.
- 인정 정보에 대한 별도의 저장소가 필요없다.
- 클라이언트 인증 정보를 저장하는 세션과 다르게, 서버는 무상태가 되어 서버 확장성이 우수해질 수 있다.
- 토큰 기반으로 다른 로그인 시스템에 접근 및 권한 공유가 가능하다.(쿠키와 차이)
- OAuth의 경우 Google같은 소셜 계정을 이용하여 다른 웹서비스에서도 로그인을 할 수 있다.
- 모바일 어플리케이션 환경에서도 잘 동작한다.

단점

- Self-contained: 토큰 자체에 정보를 담고 있으므로 다른 한편으로 위험하다 볼 수 있다.
- 토큰 길이 : 토큰의 Payload에 3종류의 클레임을 저장하기 때문에, 정보가 많아질수록 토큰의 길이가 늘어나 네트워크에 부하를 줄 수 있다.
- Payload 인코딩 : payload 자체는 암호화된 것이 아니라 BASE64로 인코딩 된 것이기 때문에 중간에 payload를 탈취해 디코딩하면 데이터를 볼 수 있으므로 payload에 중요한 정보를 담지 않아야 한다.
- Store Token : 무상태 특징을 가지기 때문에, 토큰은 클라이언트 측에서 관리하고 저장한다. 때문에 토큰 자체를 탈취당하면 대처하기 어렵다.

## JWT의 Access Token / Refresh Token 방식

JWT도 제 3자에게 탈취당할 위험성이 있기 때문에 그대로 사용하는 것이 아니고 Access Token과 Refresh Token으로 나누어 인증을 하는 방식을 주로 쓴다. 둘다 똑같은 JWT 토큰이지만 어디에 저장되고 관리되느냐에 따라 다르다.

Access Token : 클라이언트가 가지고 있는 실제로 유저의 정보가 담긴 토큰으로, 클라이언트에서 요청이 오면 서버에서 해당 토큰에 있는 정보를 활용하여 사용자 정보에 맞게 응답을 진행한다.

Refresh Token: 새로운 Access Token을 발급해주기 위해 사용하는 토큰으로 짧은 수명을 가지는 Access Token에게 새로운 토큰을 발급해주기 위해 사용. 해당 토큰은 보통 데이터베이스에 유저 정보와 같이 기록된다.



출처

- https://inpa.tistory.com/entry/WEB-%F0%9F%93%9A-JWTjson-web-token-%EB%9E%80-%F0%9F%92%AF-%EC%A0%95%EB%A6%AC
- https://pronist.dev/143
